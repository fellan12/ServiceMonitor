<!DOCTYPE html>
<html>
  <head>
	<meta charset="UTF-8">
    <title>Service Monitor Tool</title>
    <script src="//code.jquery.com/jquery-1.11.3.min.js"></script>
    <script type="text/javascript">
    	$(function () {
		    load();
		});

		function create(name, url) {
			$.post("/service", JSON.stringify({name: name, url: url}), function () {
		        load();
		    }, "json");
		}

		function remove(id) {
			$.ajax({
		        method: "Remove",
		        url: "/service/" + id
		    }).done(function () {
		        load();
		    });
		}

		function load() {
			console.log("Loading page");
			$("#content").children().remove();
			$.getJSON("/service", function (data) {
				$.each(data, function (k, v) {
					if (k === "services") {
						$.each(v, function(key, val) {
						    $("<tr><td>" + val.id + "</td><td>" + val.name + "</td><td>" + val.url + "</td>" +
					            "<td>" + val.status + "</td>" +
					            "<td>" +
					            "<button class='service-delete' " +
					            "data-name='" + val.name + "' " +
					            "data-url='" + val.url + "' " +
					            "data-id='" + val.id + "' " +
					            "data-status='" + val.status + "'>Remove</button>" +
					            "</td>" +
					            "</tr>").appendTo("#content");
						})
					}
				})
			});
			initCallbacks();
		}

		function initCallbacks() {
		    $("#content").unbind().on("click", ".service-delete", function() {
		        var id = $(this).data("id");
		        console.log("Pressing Remove button: "+id);
		        remove(id);
		    });

		    $("#add-btn").unbind().click(function() {
		    	var name = $("#input-name").val();
		    	var url = $("#input-url").val();
		    	$("#input-name").val('');
		    	$("#input-url").val('');
		    	console.log("Pressing add button: "+name+", "+url);
		    	create(name, url);
		    });
		}
    </script>
    <style>
        .add-service {
	    padding-bottom: 2%;
	    text-align: left;
	    vertical-align: left;
	    width: 30%;
        }

        table {
          font-family: arial, sans-serif;
          border-collapse: collapse;
          width: 100%;
      }

      td, th {
          border: 1px solid #dddddd;
          text-align: left;
          padding: 8px;
      }

      tr:nth-child(even) {
          background-color: #dddddd;
      }
    </style>
  </head>
  <body>
	<div class="container" role="main">
	    <div class="jumbotron">
	        <h1>Service Monitor</h1>
	    </div>
	    <div class="page-header">
	        <div class="row">
	            <div class="col-md-12">
                	<div class="add-service">
                      <h2>Add New Service</h2>
                      <p>Name: <input id="input-name" name="Name"></p>
                      <p>Url:  <input id="input-url" name="Url"></p>
                	    <button class="btn" id="add-btn" data-action="add">Add</button>
                  </div>
                  <h1>Services</h1>
                  <table class="table table-striped">
                      <thead>
                      <tr>
                          <th>#</th>
                          <th>Name</th>
                          <th>Url</th>
                          <th>Status</th>
                          <th>Action</th>
                      </tr>
                      </thead>
                      <tbody id="content">
                      <!-- filled using Ajax -->
                      </tbody>
                  </table>
	            </div>
	        </div>
	    </div>
	</div>
  </body>
</html>
